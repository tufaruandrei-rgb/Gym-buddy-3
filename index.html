<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Gym Buddy</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 text-white min-h-screen">
    <div id="app"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as SVG components
        const Plus = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Trash2 = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const TrendingUp = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
        );

        const RefreshCw = ({ spinning }) => (
            <svg className={`w-4 h-4 ${spinning ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        );

        const Upload = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const Settings = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        );

        const GymBuddy = () => {
            const exercises = {
                'Spate': ['Lat pulldown', 'Machine row', 'Cable row', 'Diag pulldown', 'Face pulls', 'Hyper extention'],
                'Piept': ['Bench', 'Bench plates', 'Chest incline press', 'Chest decline press', 'Chest flies', 'Chest downpush'],
                'Upper body': ['Shoulder press', 'Shoulder lat extension', 'Bar curl', 'Biceps curl', 'Preacher curl', 
                            'Dips', 'Weight assist dips', 'Cable extension', 'Rope extension'],
                'Picioare': ['Squats', 'Leg extension', 'Leg Curls', 'Calf press']
            };

            const [sheetsUrl, setSheetsUrl] = useState('');
            const [showSettings, setShowSettings] = useState(false);
            const [historicData, setHistoricData] = useState([]);
            const [prCache, setPrCache] = useState({});
            const [workoutPRs, setWorkoutPRs] = useState({});
            const [pendingWorkouts, setPendingWorkouts] = useState([]);
            const [syncing, setSyncing] = useState(false);
            const [lastSync, setLastSync] = useState(null);

            const [workout, setWorkout] = useState({
                category: 'Spate',
                date: new Date().toISOString().split('T')[0],
                feeling: 'Ok'
            });

            const [currentExercises, setCurrentExercises] = useState([
                { name: exercises['Spate'][0], sets: [{ reps: '', weight: '', effort: 3 }] }
            ]);

            const [showHistory, setShowHistory] = useState(false);

            // Load from localStorage
            useEffect(() => {
                const url = localStorage.getItem('sheetsUrl');
                if (url) setSheetsUrl(url);
                
                const historic = localStorage.getItem('historicData');
                if (historic) setHistoricData(JSON.parse(historic));
                
                const prs = localStorage.getItem('prCache');
                if (prs) setPrCache(JSON.parse(prs));
                
                const wprs = localStorage.getItem('workoutPRs');
                if (wprs) setWorkoutPRs(JSON.parse(wprs));
                
                const pending = localStorage.getItem('pendingWorkouts');
                if (pending) setPendingWorkouts(JSON.parse(pending));
                
                const sync = localStorage.getItem('lastSync');
                if (sync) setLastSync(sync);
            }, []);

            // Format date helper
            const formatDateShort = (dateStr) => {
                const date = new Date(dateStr);
                const day = date.getDate();
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                const month = months[date.getMonth()];
                const year = date.getFullYear().toString().slice(-2);
                return `${day}-${month}-${year}`;
            };

            const getWeekStart = (dateStr) => {
                const date = new Date(dateStr);
                const day = date.getDay();
                const diff = date.getDate() - day + (day === 0 ? -6 : 1);
                const monday = new Date(date.setDate(diff));
                return formatDateShort(monday.toISOString().split('T')[0]);
            };

            // Calculate PR from historic data
            const calculatePRCache = (data) => {
                const cache = {};
                const wPRs = {};

                data.forEach(row => {
                    const ex = row.Exercitiu;
                    const cat = row['Zi de?'];
                    const weight = parseFloat(row.Greutate);
                    const vol = parseFloat(row.Volum);
                    const date = row.Data;
                    const set = parseInt(row.Set);

                    if (!ex || !weight || !vol) return;

                    // PR per exercise
                    if (!cache[ex]) {
                        cache[ex] = {
                            prWeight: weight,
                            prVolSet: vol,
                            prVolEx: 0,
                            lastWeights: {}
                        };
                    } else {
                        if (weight > cache[ex].prWeight) cache[ex].prWeight = weight;
                        if (vol > cache[ex].prVolSet) cache[ex].prVolSet = vol;
                    }

                    // Last weights per set number
                    if (!cache[ex].lastWeights[set]) {
                        cache[ex].lastWeights[set] = { weight, date };
                    } else {
                        const lastDate = new Date(cache[ex].lastWeights[set].date);
                        const currentDate = new Date(date);
                        if (currentDate > lastDate) {
                            cache[ex].lastWeights[set] = { weight, date };
                        }
                    }
                });

                // Calculate PR vol per exercise
                const workoutGroups = {};
                data.forEach(row => {
                    const key = `${row.Data}_${row.Exercitiu}`;
                    if (!workoutGroups[key]) workoutGroups[key] = 0;
                    workoutGroups[key] += parseFloat(row.Volum || 0);
                });

                Object.keys(workoutGroups).forEach(key => {
                    const ex = key.split('_').slice(1).join('_');
                    if (cache[ex]) {
                        cache[ex].prVolEx = Math.max(cache[ex].prVolEx || 0, workoutGroups[key]);
                    }
                });

                // Calculate PR vol per workout
                const catGroups = {};
                data.forEach(row => {
                    const key = `${row.Data}_${row['Zi de?']}`;
                    if (!catGroups[key]) catGroups[key] = 0;
                    catGroups[key] += parseFloat(row.Volum || 0);
                });

                Object.keys(catGroups).forEach(key => {
                    const cat = key.split('_').slice(1).join('_');
                    wPRs[cat] = Math.max(wPRs[cat] || 0, catGroups[key]);
                });

                return { cache, wPRs };
            };

            // Sync from Sheets
            const syncFromSheets = async () => {
                if (!sheetsUrl) {
                    alert('Please set Google Sheets URL first!');
                    setShowSettings(true);
                    return;
                }

                setSyncing(true);
                try {
                    const response = await fetch(sheetsUrl);
                    const text = await response.text();
                    
                    const lines = text.split('\n').filter(l => l.trim());
                    const headers = lines[0].split('\t');
                    
                    const data = lines.slice(1).map(line => {
                        const values = line.split('\t');
                        const row = {};
                        headers.forEach((h, i) => {
                            row[h] = values[i] || '';
                        });
                        if (row.Data && row.Data.includes('GMT')) {
                            row.Data = formatDateShort(row.Data);
                        }
                        return row;
                    });

                    setHistoricData(data);
                    localStorage.setItem('historicData', JSON.stringify(data));

                    const { cache, wPRs } = calculatePRCache(data);
                    setPrCache(cache);
                    setWorkoutPRs(wPRs);
                    localStorage.setItem('prCache', JSON.stringify(cache));
                    localStorage.setItem('workoutPRs', JSON.stringify(wPRs));

                    const now = new Date().toISOString();
                    setLastSync(now);
                    localStorage.setItem('lastSync', now);

                    alert(`✅ Synced ${data.length} rows!`);
                } catch (error) {
                    alert('Sync failed: ' + error.message);
                }
                setSyncing(false);
            };

            // Calculate scores
            const calculateSetScore = (ex, reps, weight, effort) => {
                const vol = reps * weight;
                const pr = prCache[ex];

                if (!pr || !pr.prVolSet) {
                    let repsAdj;
                    if (reps <= 6) repsAdj = reps * 3;
                    else if (reps <= 10) repsAdj = 18 + (reps - 6) * 2.5;
                    else repsAdj = 28 + (reps - 10) * 1.2;

                    const effortAdj = repsAdj + (effort - 1) * 5;
                    const maxEff = [70, 80, 85, 95, 100][effort - 1];
                    return Math.round(Math.min(maxEff, effortAdj));
                }

                const ratioRaw = vol / pr.prVolSet;
                const effortMult = 0.85 + effort * 0.06;
                const ratioAdj = ratioRaw * effortMult;

                if (ratioAdj >= 1.07) return 100;
                if (ratioAdj >= 1.05) return Math.round(97 + (ratioAdj - 1.05) / 0.02 * 3);
                if (ratioAdj >= 1) return Math.round(92 + (ratioAdj - 1) / 0.05 * 5);
                if (ratioAdj >= 0.9) return Math.round(85 + (ratioAdj - 0.9) / 0.1 * 7);
                if (ratioAdj >= 0.8) return Math.round(75 + (ratioAdj - 0.8) / 0.1 * 10);
                return Math.round(ratioAdj / 0.8 * 75);
            };

            const calculateExerciseScore = (ex, sets) => {
                const validSets = sets.filter(s => s.reps && s.weight);
                if (validSets.length === 0) return 0;

                const avgSetScore = validSets.reduce((sum, s) => {
                    return sum + calculateSetScore(ex, parseInt(s.reps), parseFloat(s.weight), s.effort);
                }, 0) / validSets.length;

                const currentVol = validSets.reduce((sum, s) => sum + parseInt(s.reps) * parseFloat(s.weight), 0);
                const pr = prCache[ex];

                if (!pr || !pr.prVolEx) return Math.round(avgSetScore);

                const ratio = Math.min(1.15, currentVol / pr.prVolEx);
                return Math.round(Math.min(100, avgSetScore * 0.7 + avgSetScore * 0.3 * ratio));
            };

            const calculateWorkoutScore = () => {
                const validExercises = currentExercises.filter(ex => 
                    ex.sets.some(s => s.reps && s.weight)
                );

                if (validExercises.length === 0) return 0;

                const exScores = validExercises.map(ex => calculateExerciseScore(ex.name, ex.sets));
                const avgExScore = exScores.reduce((a, b) => a + b, 0) / exScores.length;

                const currentVol = validExercises.reduce((sum, ex) => {
                    return sum + ex.sets.reduce((s, set) => {
                        if (!set.reps || !set.weight) return s;
                        return s + parseInt(set.reps) * parseFloat(set.weight);
                    }, 0);
                }, 0);

                const prVol = workoutPRs[workout.category];
                if (!prVol) return Math.round(avgExScore);

                const ratio = Math.min(1.15, currentVol / prVol);
                return Math.round(Math.min(100, avgExScore * 0.7 + avgExScore * 0.3 * ratio));
            };

            const currentWorkoutScore = calculateWorkoutScore();

            // UI Handlers
            const addSet = (exerciseIndex) => {
                const newExercises = [...currentExercises];
                const lastSet = newExercises[exerciseIndex].sets[newExercises[exerciseIndex].sets.length - 1];
                newExercises[exerciseIndex].sets.push({ 
                    reps: lastSet.reps, 
                    weight: lastSet.weight, 
                    effort: lastSet.effort 
                });
                setCurrentExercises(newExercises);
            };

            const updateSet = (exerciseIndex, setIndex, field, value) => {
                const newExercises = [...currentExercises];
                newExercises[exerciseIndex].sets[setIndex][field] = value;
                setCurrentExercises(newExercises);
            };

            const removeSet = (exerciseIndex, setIndex) => {
                const newExercises = [...currentExercises];
                newExercises[exerciseIndex].sets = newExercises[exerciseIndex].sets.filter((_, i) => i !== setIndex);
                setCurrentExercises(newExercises);
            };

            const updateExerciseName = (exerciseIndex, name) => {
                const newExercises = [...currentExercises];
                newExercises[exerciseIndex].name = name;
                setCurrentExercises(newExercises);
            };

            const addExercise = () => {
                setCurrentExercises([
                    ...currentExercises,
                    { name: exercises[workout.category][0], sets: [{ reps: '', weight: '', effort: 3 }] }
                ]);
            };

            const removeExercise = (exerciseIndex) => {
                setCurrentExercises(currentExercises.filter((_, i) => i !== exerciseIndex));
            };

            const saveWorkout = () => {
                const validExercises = currentExercises
                    .map(ex => ({
                        ...ex,
                        sets: ex.sets.filter(s => s.reps && s.weight)
                    }))
                    .filter(ex => ex.sets.length > 0);

                if (validExercises.length === 0) {
                    alert('Add at least one complete set!');
                    return;
                }

                const rows = [];
                const dateShort = formatDateShort(workout.date);
                const weekStart = getWeekStart(workout.date);
                const workoutScore = calculateWorkoutScore();

                validExercises.forEach(ex => {
                    const exScore = calculateExerciseScore(ex.name, ex.sets);
                    
                    ex.sets.forEach((set, idx) => {
                        const vol = parseInt(set.reps) * parseFloat(set.weight);
                        const setScore = calculateSetScore(ex.name, parseInt(set.reps), parseFloat(set.weight), set.effort);
                        
                        const pr = prCache[ex.name] || {};
                        const prVolSet = pr.prVolSet || 'TBD';
                        const prWeight = pr.prWeight || 'TBD';
                        const prVolEx = pr.prVolEx || 'TBD';
                        const prVolWorkout = workoutPRs[workout.category] || 'TBD';

                        rows.push([
                            dateShort,
                            ex.name,
                            idx + 1,
                            set.reps,
                            set.weight,
                            workout.category,
                            vol,
                            weekStart,
                            set.effort,
                            setScore,
                            exScore,
                            workoutScore,
                            workout.feeling,
                            prVolSet,
                            prWeight,
                            prVolEx,
                            prVolWorkout
                        ].join('\t'));
                    });
                });

                const newPending = [...pendingWorkouts, {
                    id: Date.now(),
                    data: rows.join('\n'),
                    attempts: 0,
                    timestamp: new Date().toISOString()
                }];

                setPendingWorkouts(newPending);
                localStorage.setItem('pendingWorkouts', JSON.stringify(newPending));

                setCurrentExercises([{ name: exercises[workout.category][0], sets: [{ reps: '', weight: '', effort: 3 }] }]);
                alert(`Workout saved! ${newPending.length} pending sync.`);
            };

            const syncPending = async () => {
                if (pendingWorkouts.length === 0) {
                    alert('No pending workouts!');
                    return;
                }

                if (!sheetsUrl) {
                    alert('Set Google Sheets URL first!');
                    setShowSettings(true);
                    return;
                }

                setSyncing(true);
                let synced = 0;
                const remaining = [];

                for (const workout of pendingWorkouts) {
                    try {
                        const response = await fetch(sheetsUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'text/plain' },
                            body: workout.data,
                            redirect: 'follow'
                        });

                        if (response.ok) {
                            synced++;
                        } else {
                            remaining.push(workout);
                        }
                    } catch (error) {
                        console.error('Sync error:', error);
                        remaining.push(workout);
                    }
                }

                setPendingWorkouts(remaining);
                localStorage.setItem('pendingWorkouts', JSON.stringify(remaining));
                
                setSyncing(false);
                alert(`✅ Synced ${synced} workouts! ${remaining.length} remaining.`);
                
                if (synced > 0) {
                    await syncFromSheets();
                }
            };

            return (
                <div className="min-h-screen p-3">
                    <div className="max-w-lg mx-auto">
                        {/* Header */}
                        <div className="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-3 border border-white/20">
                            <div className="flex items-center justify-between mb-3">
                                <div className="flex items-center gap-2">
                                    <span className="text-2xl">💪</span>
                                    <h1 className="text-xl font-bold">Gym Buddy</h1>
                                </div>
                                <div className="flex gap-2">
                                    <button
                                        onClick={() => setShowHistory(!showHistory)}
                                        className="px-3 py-1.5 text-sm bg-purple-600 rounded-lg hover:bg-purple-700 transition"
                                    >
                                        {showHistory ? 'Track' : 'History'}
                                    </button>
                                    <button
                                        onClick={() => setShowSettings(!showSettings)}
                                        className="p-1.5 bg-white/10 rounded-lg hover:bg-white/20 transition"
                                    >
                                        <Settings />
                                    </button>
                                </div>
                            </div>

                            {!showHistory && currentWorkoutScore > 0 && (
                                <div className="flex items-center justify-between bg-white/5 rounded-lg p-2">
                                    <span className="text-sm text-purple-300">Workout Score:</span>
                                    <span className="text-lg font-bold text-green-400">{currentWorkoutScore}/100</span>
                                </div>
                            )}

                            {showSettings && (
                                <div className="mt-3 p-3 bg-white/5 rounded-lg space-y-2">
                                    <input
                                        type="text"
                                        value={sheetsUrl}
                                        onChange={(e) => setSheetsUrl(e.target.value)}
                                        placeholder="Google Sheets URL"
                                        className="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-sm text-white placeholder-white/50"
                                    />
                                    <button
                                        onClick={() => {
                                            localStorage.setItem('sheetsUrl', sheetsUrl);
                                            setShowSettings(false);
                                            alert('URL saved!');
                                        }}
                                        className="w-full py-2 text-sm bg-green-600 hover:bg-green-700 rounded-lg transition"
                                    >
                                        Save URL
                                    </button>
                                </div>
                            )}
                        </div>

                        {showHistory ? (
                            <div className="bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20">
                                <div className="flex gap-2 mb-4">
                                    <button
                                        onClick={syncFromSheets}
                                        disabled={syncing}
                                        className="flex-1 py-2 text-sm bg-blue-600 hover:bg-blue-700 rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50"
                                    >
                                        <RefreshCw spinning={syncing} />
                                        Sync from Sheets
                                    </button>
                                    <button
                                        onClick={syncPending}
                                        disabled={syncing || pendingWorkouts.length === 0}
                                        className="flex-1 py-2 text-sm bg-green-600 hover:bg-green-700 rounded-lg transition flex items-center justify-center gap-2 disabled:opacity-50"
                                    >
                                        <Upload />
                                        Push ({pendingWorkouts.length})
                                    </button>
                                </div>

                                {lastSync && (
                                    <p className="text-xs text-white/50 text-center mb-3">
                                        Last sync: {new Date(lastSync).toLocaleString()}
                                    </p>
                                )}

                                <div className="text-sm text-white/70">
                                    <p>Historic rows: {historicData.length}</p>
                                    <p>Exercises tracked: {Object.keys(prCache).length}</p>
                                </div>
                            </div>
                        ) : (
                            <>
                                {/* Feeling Question */}
                                <div className="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-3 border border-white/20">
                                    <label className="block text-sm text-purple-300 mb-2">How are you feeling today?</label>
                                    <div className="grid grid-cols-3 gap-2">
                                        {[
                                            { value: 'Battery low', emoji: '🪫', label: 'Low' },
                                            { value: 'Ok', emoji: '😊', label: 'Ok' },
                                            { value: 'Energized', emoji: '⚡', label: 'Energized' }
                                        ].map(({ value, emoji, label }) => (
                                            <button
                                                key={value}
                                                onClick={() => setWorkout({ ...workout, feeling: value })}
                                                className={`py-2 rounded-lg transition text-sm ${
                                                    workout.feeling === value
                                                        ? 'bg-orange-600 text-white'
                                                        : 'bg-white/10 text-white/60 hover:bg-white/20'
                                                }`}
                                            >
                                                <div className="text-2xl mb-1">{emoji}</div>
                                                <div>{label}</div>
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Workout Setup */}
                                <div className="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-3 border border-white/20">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs text-purple-300 mb-1">Date</label>
                                            <input
                                                type="date"
                                                value={workout.date}
                                                onChange={(e) => setWorkout({ ...workout, date: e.target.value })}
                                                className="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-sm text-white"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Exercises */}
                                {currentExercises.map((exercise, exerciseIndex) => {
                                    const pr = prCache[exercise.name];
                                    return (
                                        <div key={exerciseIndex} className="bg-white/10 backdrop-blur-lg rounded-xl p-4 mb-3 border border-white/20">
                                            <div className="flex justify-between items-center mb-2">
                                                <span className="text-xs text-purple-300">Exercise {exerciseIndex + 1}</span>
                                                {currentExercises.length > 1 && (
                                                    <button
                                                        onClick={() => removeExercise(exerciseIndex)}
                                                        className="text-red-400 hover:text-red-300 p-1"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                )}
                                            </div>

                                            <select
                                                value={exercise.name}
                                                onChange={(e) => updateExerciseName(exerciseIndex, e.target.value)}
                                                className="w-full mb-2 bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-sm text-white"
                                            >
                                                {exercises[workout.category].map(ex => (
                                                    <option key={ex} value={ex}>{ex}</option>
                                                ))}
                                            </select>

                                            {pr ? (
                                                <div className="text-xs text-purple-300/60 mb-3 flex items-center gap-3">
                                                    <span>💪 PR Weight: <strong>{pr.prWeight}kg</strong></span>
                                                </div>
                                            ) : (
                                                <div className="text-xs text-white/40 mb-3">No PR yet</div>
                                            )}

                                            <div className="space-y-3 mb-3">
                                                {exercise.sets.map((set, setIndex) => {
                                                    const lastWeight = pr?.lastWeights?.[setIndex + 1]?.weight;
                                                    return (
                                                        <div key={setIndex} className="space-y-2">
                                                            <div className="flex gap-2 items-center">
                                                                <span className="text-purple-300 font-semibold text-sm w-6">{setIndex + 1}</span>
                                                                <select
                                                                    value={set.reps}
                                                                    onChange={(e) => updateSet(exerciseIndex, setIndex, 'reps', e.target.value)}
                                                                    className="flex-1 bg-white/20 border border-white/30 rounded-lg px-2 py-2 text-sm text-white"
                                                                >
                                                                    <option value="">Reps</option>
                                                                    {[...Array(40)].map((_, i) => (
                                                                        <option key={i + 1} value={i + 1}>{i + 1}</option>
                                                                    ))}
                                                                </select>
                                                                <input
                                                                    type="number"
                                                                    placeholder="kg"
                                                                    value={set.weight}
                                                                    onChange={(e) => {
                                                                        const val = parseFloat(e.target.value);
                                                                        if (e.target.value === '' || val >= 0) {
                                                                            updateSet(exerciseIndex, setIndex, 'weight', e.target.value);
                                                                        }
                                                                    }}
                                                                    min="0"
                                                                    step="0.5"
                                                                    className="flex-1 bg-white/20 border border-white/30 rounded-lg px-2 py-2 text-sm text-white placeholder-white/50"
                                                                />
                                                                {exercise.sets.length > 1 && (
                                                                    <button
                                                                        onClick={() => removeSet(exerciseIndex, setIndex)}
                                                                        className="p-2 bg-red-500/20 hover:bg-red-500/30 rounded-lg transition"
                                                                    >
                                                                        <Trash2 />
                                                                    </button>
                                                                )}
                                                            </div>
                                                            
                                                            {lastWeight && (
                                                                <div className="text-xs text-blue-300/60 pl-8 flex items-center gap-1">
                                                                    <span>📊 Last Set {setIndex + 1}:</span>
                                                                    <strong>{lastWeight}kg</strong>
                                                                </div>
                                                            )}

                                                            <div className="flex gap-1 pl-8">
                                                                {[1, 2, 3, 4, 5].map(level => (
                                                                    <button
                                                                        key={level}
                                                                        onClick={() => updateSet(exerciseIndex, setIndex, 'effort', level)}
                                                                        onMouseEnter={(e) => {
                                                                            const btns = e.currentTarget.parentElement.children;
                                                                            for (let i = 0; i < btns.length; i++) {
                                                                                if (i < level) {
                                                                                    btns[i].style.opacity = '1';
                                                                                    btns[i].style.filter = 'brightness(1.2)';
                                                                                } else {
                                                                                    btns[i].style.opacity = '0.3';
                                                                                    btns[i].style.filter = 'brightness(0.5)';
                                                                                }
                                                                            }
                                                                        }}
                                                                        onMouseLeave={(e) => {
                                                                            const btns = e.currentTarget.parentElement.children;
                                                                            for (let i = 0; i < btns.length; i++) {
                                                                                if (i < set.effort) {
                                                                                    btns[i].style.opacity = '1';
                                                                                    btns[i].style.filter = 'brightness(1)';
                                                                                } else {
                                                                                    btns[i].style.opacity = '0.3';
                                                                                    btns[i].style.filter = 'brightness(0.5)';
                                                                                }
                                                                            }
                                                                        }}
                                                                        className={`flex-1 py-1 rounded transition-all ${
                                                                            level <= set.effort ? 'opacity-100' : 'opacity-30'
                                                                        }`}
                                                                        style={{ 
                                                                            fontSize: '18px',
                                                                            filter: level <= set.effort ? 'brightness(1)' : 'brightness(0.5)'
                                                                        }}
                                                                    >
                                                                        💪
                                                                    </button>
                                                                ))}
                                                            </div>
                                                            <div className="text-xs text-purple-300/60 text-center pl-8">
                                                                {['Foarte ușor', 'Ușor', 'OK', 'Greu', 'Foarte greu'][set.effort - 1]}
                                                            </div>
                                                        </div>
                                                    );
                                                })}
                                            </div>

                                            <button
                                                onClick={() => addSet(exerciseIndex)}
                                                className="w-full py-2 text-sm bg-white/10 hover:bg-white/20 rounded-lg transition flex items-center justify-center gap-2 border border-white/30"
                                            >
                                                <Plus />
                                                Add Set
                                            </button>
                                        </div>
                                    );
                                })}

                                <button
                                    onClick={addExercise}
                                    className="w-full mb-3 py-2 text-sm bg-purple-600 hover:bg-purple-700 rounded-lg transition font-semibold flex items-center justify-center gap-2"
                                >
                                    <Plus />
                                    Add Exercise
                                </button>

                                <button
                                    onClick={saveWorkout}
                                    className="w-full py-3 bg-green-600 hover:bg-green-700 rounded-lg transition font-bold flex items-center justify-center gap-2"
                                >
                                    <TrendingUp />
                                    Save Workout
                                </button>
                            </>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<GymBuddy />, document.getElementById('app'));
    </script>
</body>
</html>purple-300 mb-1">Workout Type</label>
                                            <select
                                                value={workout.category}
                                                onChange={(e) => {
                                                    const cat = e.target.value;
                                                    setWorkout({ ...workout, category: cat });
                                                    setCurrentExercises([{ name: exercises[cat][0], sets: [{ reps: '', weight: '', effort: 3 }] }]);
                                                }}
                                                className="w-full bg-white/20 border border-white/30 rounded-lg px-3 py-2 text-sm text-white"
                                            >
                                                {Object.keys(exercises).map(cat => (
                                                    <option key={cat} value={cat}>{cat}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs text-
